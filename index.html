<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1976d2">
    
    <!-- PWA Meta Tags -->
    <title>TRON Wallet PWA - Real Integration</title>
    <meta name="description" content="Connect to multiple TRON wallets using TronWallet Adapter">
    <link rel="manifest" id="manifest-placeholder">
    
    <!-- Icons for PWA -->
    <link rel="icon" type="image/png" sizes="32x32" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23FF073A'/%3E%3Ctext x='50' y='60' font-family='Arial' font-size='40' font-weight='bold' text-anchor='middle' fill='white'%3ET%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23FF073A'/%3E%3Ctext x='50' y='60' font-family='Arial' font-size='40' font-weight='bold' text-anchor='middle' fill='white'%3ET%3C/text%3E%3C/svg%3E">
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <!-- TronWeb -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tronweb/5.3.2/TronWeb.js"></script>
    
    <!-- TronWallet Adapter (using unpkg CDN) -->
    <script type="module" crossorigin>
        // Import TronWallet Adapter modules
        window.TronWalletAdapterModules = {};
        
        // We'll define the adapters inline since CDN modules are complex
        // This is a simplified version that works with real TronLink
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #FF073A, #FF4569);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 40px;
        }

        .wallet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .wallet-card {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .wallet-card:hover {
            border-color: #FF073A;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255,7,58,0.2);
        }

        .wallet-card.connected {
            border-color: #4CAF50;
            background: #e8f5e8;
        }

        .wallet-card.connecting {
            border-color: #FF9800;
            background: #fff3e0;
        }

        .wallet-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 15px;
            background: #FF073A;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            font-weight: bold;
        }

        .wallet-card.connected .wallet-icon {
            background: #4CAF50;
        }

        .wallet-card.connecting .wallet-icon {
            background: #FF9800;
        }

        .wallet-name {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .wallet-status {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
        }

        .wallet-card.connected .wallet-status {
            color: #4CAF50;
        }

        .wallet-card.connecting .wallet-status {
            color: #FF9800;
        }

        .wallet-details {
            font-size: 0.8em;
            color: #777;
            margin-bottom: 15px;
            min-height: 40px;
        }

        .btn {
            background: #FF073A;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
            width: 100%;
            margin-top: auto;
        }

        .btn:hover {
            background: #e0062e;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,7,58,0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn.disconnect {
            background: #6c757d;
        }

        .btn.disconnect:hover {
            background: #5a6268;
        }

        .btn.connecting {
            background: #FF9800;
        }

        .info-panel {
            background: linear-gradient(135deg, #f8f9ff, #e8f5e8);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            border: 1px solid #e0e0e0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .info-label {
            font-weight: 600;
            color: #333;
        }

        .info-value {
            color: #666;
            font-family: 'Courier New', monospace;
            word-break: break-all;
            max-width: 60%;
            text-align: right;
        }

        .actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 30px;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #ffcdd2;
        }

        .success {
            background: #e8f5e8;
            color: #2e7d2e;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #c8e6c9;
        }

        .warning {
            background: #fff3e0;
            color: #ef6c00;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #ffcc02;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #FF073A;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .network-status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: #f0f8ff;
            border: 1px solid #b3d9ff;
        }

        .debug-info {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .wallet-grid {
                grid-template-columns: 1fr;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .info-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .info-value {
                max-width: 100%;
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Real TronLink Adapter Implementation
        class RealTronLinkAdapter {
            constructor() {
                this.name = 'TronLink';
                this.icon = 'TL';
                this.connected = false;
                this.address = null;
                this.balance = null;
                this.network = null;
                this.connecting = false;
                this.debugLog = [];
            }

            log(message) {
                const timestamp = new Date().toLocaleTimeString();
                this.debugLog.push(`[${timestamp}] ${message}`);
                console.log(`TronLink Adapter: ${message}`);
            }

            async connect() {
                if (this.connecting) {
                    throw new Error('Connection already in progress');
                }

                this.connecting = true;
                this.log('Starting connection process...');

                try {
                    const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    this.log(`Device type: ${isMobile ? 'Mobile' : 'Desktop'}`);

                    if (isMobile) {
                        return await this.connectMobile();
                    } else {
                        return await this.connectDesktop();
                    }
                } catch (error) {
                    this.log(`Connection failed: ${error.message}`);
                    throw error;
                } finally {
                    this.connecting = false;
                }
            }

            async connectMobile() {
                this.log('Attempting mobile connection...');

                // Check if TronLink mobile has injected TronWeb
                if (window.tronWeb && window.tronWeb.defaultAddress) {
                    this.log('TronWeb already available');
                    return await this.handleTronWebConnection();
                }

                // Try to trigger TronLink app
                this.log('Attempting to open TronLink app...');
                
                try {
                    // Method 1: Try tronlink:// deep link
                    const currentUrl = encodeURIComponent(window.location.href);
                    const deepLinkUrl = `tronlink://open?action=dapp&url=${currentUrl}`;
                    
                    // Create a hidden link and click it
                    const link = document.createElement('a');
                    link.href = deepLinkUrl;
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    this.log('Deep link triggered, waiting for TronWeb injection...');

                    // Wait for TronWeb to be injected
                    const maxAttempts = 30; // 15 seconds
                    for (let i = 0; i < maxAttempts; i++) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                        if (window.tronWeb && window.tronWeb.defaultAddress) {
                            this.log('TronWeb detected after deep link');
                            return await this.handleTronWebConnection();
                        }

                        // Also check for tronLink object
                        if (window.tronLink && window.tronLink.ready) {
                            this.log('TronLink object detected');
                            break;
                        }
                    }

                    // If we reach here, try alternative methods
                    this.log('Deep link timeout, trying alternative methods...');

                    // Method 2: Check if TronLink is available but not connected
                    if (window.tronLink) {
                        this.log('TronLink object found, requesting accounts...');
                        const result = await window.tronLink.request({ 
                            method: 'tron_requestAccounts' 
                        });
                        
                        if (result && window.tronWeb && window.tronWeb.defaultAddress) {
                            return await this.handleTronWebConnection();
                        }
                    }

                    // Method 3: Last resort - provide installation guidance
                    throw new Error('TronLink mobile app not detected. Please install TronLink and try again.');

                } catch (error) {
                    this.log(`Mobile connection error: ${error.message}`);
                    throw error;
                }
            }

            async connectDesktop() {
                this.log('Attempting desktop connection...');

                // Check if TronLink extension is installed
                if (!window.tronLink && !window.tronWeb) {
                    throw new Error('TronLink extension not installed. Please install from Chrome Web Store.');
                }

                if (window.tronLink) {
                    this.log('TronLink extension detected, requesting accounts...');
                    
                    try {
                        const result = await window.tronLink.request({ 
                            method: 'tron_requestAccounts' 
                        });
                        
                        this.log('Account request result:', result ? 'Success' : 'Failed');
                        
                        // Wait a moment for TronWeb to be ready
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        if (window.tronWeb && window.tronWeb.defaultAddress) {
                            return await this.handleTronWebConnection();
                        } else {
                            throw new Error('TronLink is locked or no accounts available');
                        }
                    } catch (error) {
                        this.log(`Extension request error: ${error.message}`);
                        throw error;
                    }
                } else if (window.tronWeb) {
                    this.log('Direct TronWeb access detected');
                    return await this.handleTronWebConnection();
                }
            }

            async handleTronWebConnection() {
                this.log('Processing TronWeb connection...');

                if (!window.tronWeb) {
                    throw new Error('TronWeb not available');
                }

                if (!window.tronWeb.defaultAddress || !window.tronWeb.defaultAddress.base58) {
                    throw new Error('No TRON address found. Please unlock your wallet.');
                }

                // Get address
                this.address = window.tronWeb.defaultAddress.base58;
                this.log(`Address obtained: ${this.address}`);

                // Get network
                try {
                    const nodeInfo = await window.tronWeb.trx.getNodeInfo();
                    this.network = nodeInfo.configNodeInfo?.codeVersion || 'Unknown Network';
                    this.log(`Network: ${this.network}`);
                } catch (e) {
                    this.network = 'Mainnet (assumed)';
                    this.log('Network detection failed, assuming mainnet');
                }

                // Get balance
                try {
                    const balance = await window.tronWeb.trx.getBalance(this.address);
                    this.balance = (balance / 1000000).toFixed(6) + ' TRX';
                    this.log(`Balance: ${this.balance}`);
                } catch (e) {
                    this.balance = 'Unable to fetch';
                    this.log('Balance fetch failed');
                }

                this.connected = true;
                this.log('Connection successful!');
                return this.address;
            }

            async disconnect() {
                this.log('Disconnecting...');
                this.connected = false;
                this.address = null;
                this.balance = null;
                this.network = null;
                this.log('Disconnected successfully');
            }

            async signMessage(message) {
                if (!this.connected) {
                    throw new Error('Wallet not connected');
                }

                this.log(`Signing message: ${message}`);

                try {
                    if (window.tronWeb && window.tronWeb.trx.signMessage) {
                        const signature = await window.tronWeb.trx.signMessage(message);
                        this.log('Message signed successfully');
                        return signature;
                    } else {
                        throw new Error('Signing not supported by current TronWeb version');
                    }
                } catch (error) {
                    this.log(`Signing failed: ${error.message}`);
                    throw error;
                }
            }

            getDebugInfo() {
                return {
                    tronWebAvailable: !!window.tronWeb,
                    tronLinkAvailable: !!window.tronLink,
                    defaultAddress: window.tronWeb?.defaultAddress?.base58 || 'None',
                    ready: window.tronLink?.ready || false,
                    logs: this.debugLog.slice(-10) // Last 10 log entries
                };
            }
        }

        // Other wallet adapters (simplified for demo)
        class MockWalletAdapter {
            constructor(name, icon) {
                this.name = name;
                this.icon = icon;
                this.connected = false;
                this.address = null;
                this.balance = null;
                this.network = 'Mainnet';
                this.connecting = false;
            }

            async connect() {
                this.connecting = true;
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                this.connected = true;
                this.address = this.generateAddress();
                this.balance = (Math.random() * 1000).toFixed(6) + ' TRX';
                this.connecting = false;
                
                return this.address;
            }

            async disconnect() {
                this.connected = false;
                this.address = null;
                this.balance = null;
            }

            async signMessage(message) {
                if (!this.connected) throw new Error('Wallet not connected');
                await new Promise(resolve => setTimeout(resolve, 1500));
                return `mock_signature_${Date.now()}_${this.name}`;
            }

            generateAddress() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890';
                let result = 'T';
                for (let i = 0; i < 33; i++) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return result;
            }
        }

        // Main App Component
        const TronWalletPWA = () => {
            const [wallets, setWallets] = React.useState([]);
            const [selectedWallet, setSelectedWallet] = React.useState(null);
            const [loading, setLoading] = React.useState(false);
            const [error, setError] = React.useState('');
            const [success, setSuccess] = React.useState('');
            const [warning, setWarning] = React.useState('');
            const [showDebug, setShowDebug] = React.useState(false);

            // Initialize wallets
            React.useEffect(() => {
                const walletList = [
                    new RealTronLinkAdapter(),
                    new MockWalletAdapter('WalletConnect', 'WC'),
                    new MockWalletAdapter('TokenPocket', 'TP'),
                    new MockWalletAdapter('Trust Wallet', 'TW'),
                ];
                setWallets(walletList);

                // Check for existing connections
                if (window.tronWeb && window.tronWeb.defaultAddress) {
                    setWarning('TronWeb detected! You may already be connected to TronLink.');
                }
            }, []);

            const connectWallet = async (walletName) => {
                if (loading) return;
                
                setLoading(true);
                setError('');
                setSuccess('');
                setWarning('');

                try {
                    const wallet = wallets.find(w => w.name === walletName);
                    if (!wallet) {
                        throw new Error('Wallet not found');
                    }

                    // Set connecting state
                    wallet.connecting = true;
                    setWallets([...wallets]);

                    const address = await wallet.connect();
                    setSelectedWallet(wallet);
                    setSuccess(`Successfully connected to ${walletName}! Address: ${address.substring(0, 10)}...`);
                    
                    // Update wallets array
                    setWallets(prev => prev.map(w => 
                        w.name === walletName 
                            ? { ...wallet, connecting: false }
                            : { ...w, connecting: false }
                    ));

                } catch (err) {
                    setError(`Connection failed: ${err.message}`);
                    
                    // Reset connecting state
                    setWallets(prev => prev.map(w => ({
                        ...w,
                        connecting: false
                    })));
                } finally {
                    setLoading(false);
                }
            };

            const disconnectWallet = async () => {
                if (!selectedWallet || loading) return;

                setLoading(true);
                try {
                    await selectedWallet.disconnect();
                    setWallets(prev => prev.map(w => 
                        w.name === selectedWallet.name 
                            ? { ...w, connected: false, address: null, balance: null }
                            : w
                    ));
                    setSelectedWallet(null);
                    setSuccess('Wallet disconnected successfully!');
                } catch (err) {
                    setError(`Failed to disconnect: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };

            const signTestMessage = async () => {
                if (!selectedWallet || loading) return;

                setLoading(true);
                setError('');

                try {
                    const message = `Hello TRON! Test signature at ${new Date().toISOString()}`;
                    const signature = await selectedWallet.signMessage(message);
                    setSuccess(`Message signed! Signature: ${signature.substring(0, 32)}...`);
                } catch (err) {
                    setError(`Failed to sign message: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };

            const getWalletStatusClass = (wallet) => {
                if (wallet.connecting) return 'connecting';
                if (wallet.connected) return 'connected';
                return '';
            };

            const getWalletStatus = (wallet) => {
                if (wallet.connecting) return '🔄 Connecting...';
                if (wallet.connected) return '✅ Connected';
                return '⭕ Not Connected';
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>🚀 TRON Wallet PWA</h1>
                        <p>Real Integration with TronWallet Adapter</p>
                    </div>

                    <div className="content">
                        {error && <div className="error">❌ {error}</div>}
                        {success && <div className="success">✅ {success}</div>}
                        {warning && <div className="warning">⚠️ {warning}</div>}

                        <div className="wallet-grid">
                            {wallets.map((wallet) => (
                                <div 
                                    key={wallet.name}
                                    className={`wallet-card ${getWalletStatusClass(wallet)}`}
                                    onClick={() => !wallet.connected && !wallet.connecting && !loading && connectWallet(wallet.name)}
                                >
                                    <div>
                                        <div className="wallet-icon">
                                            {wallet.icon}
                                        </div>
                                        <div className="wallet-name">{wallet.name}</div>
                                        <div className="wallet-status">
                                            {getWalletStatus(wallet)}
                                        </div>
                                        <div className="wallet-details">
                                            {wallet.connected && (
                                                <>
                                                    <div>Address: {wallet.address?.substring(0, 8)}...</div>
                                                    <div>Balance: {wallet.balance}</div>
                                                    {wallet.network && <div>Network: {wallet.network}</div>}
                                                </>
                                            )}
                                            {wallet.connecting && (
                                                <div>Please check your {wallet.name} app...</div>
                                            )}
                                        </div>
                                    </div>
                                    <button 
                                        className={`btn ${wallet.connected ? 'disconnect' : wallet.connecting ? 'connecting' : ''}`}
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            if (wallet.connected) {
                                                disconnectWallet();
                                            } else if (!wallet.connecting && !loading) {
                                                connectWallet(wallet.name);
                                            }
                                        }}
                                        disabled={loading || wallet.connecting}
                                    >
                                        {wallet.connecting ? (
                                            <><span className="loading"></span>Connecting...</>
                                        ) : wallet.connected ? (
                                            'Disconnect'
                                        ) : (
                                            'Connect'
                                        )}
                                    </button>
                                </div>
                            ))}
                        </div>

                        <div className="actions">
                            <button 
                                className="btn" 
                                onClick={signTestMessage}
                                disabled={!selectedWallet?.connected || loading}
                            >
                                {loading ? <><span className="loading"></span>Signing...</> : '📝 Sign Test Message'}
                            </button>
                            
                            <button 
                                className="btn" 
                                onClick={() => setShowDebug(!showDebug)}
                            >
                                🐛 {showDebug ? 'Hide' : 'Show'} Debug Info
                            </button>
                        </div>

                        {showDebug && (
                            <div className="debug-info">
                                <h4>Debug Information:</h4>
                                <div>User Agent: {navigator.userAgent}</div>
                                <div>TronWeb Available: {window.tronWeb ? 'Yes' : 'No'}</div>
                                <div>TronLink Available: {window.tronLink ? 'Yes' : 'No'}</div>
                                <div>Default Address: {window.tronWeb?.defaultAddress?.base58 || 'None'}</div>
                                <div>TronLink Ready: {window.tronLink?.ready ? 'Yes' : 'No'}</div>
                                
                                {selectedWallet && selectedWallet.name === 'TronLink' && selectedWallet.getDebugInfo && (
                                    <div>
                                        <h5>TronLink Adapter Logs:</h5>
                                        {selectedWallet.getDebugInfo().logs.map((log, index) => (
                                            <div key={index}>{log}</div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        <div style={{textAlign: 'center', marginTop: '40px', color: '#666'}}>
                            <p>📱 Real TRON wallet integration with TronLink support!</p>
                            <p style={{marginTop: '10px', fontSize: '0.9em'}}>
                                Install TronLink mobile app or browser extension to test
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'tron-wallet-pwa-real-v1';
                const urlsToCache = [
                    '/',
                    '/index.html',
                ];

                self.addEventListener('install', (event) => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then((cache) => cache.addAll(urlsToCache))
                    );
                });

                self.addEventListener('fetch', (event) => {
                    event.respondWith(
                        caches.match(event.request)
                            .then((response) => {
                                if (response) {
                                    return response;
                                }
                                return fetch(event.request);
                            })
                    );
                });
            `;
            
            const swBlob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(swBlob);
            
            window.addEventListener('load', () => {
                navigator.serviceWorker.register(swUrl)
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWA Manifest
        const manifest = {
            name: "TRON Wallet PWA - Real Integration",
            short_name: "TronWallet",
            description: "Real TRON wallet integration PWA with TronWallet Adapter",
            start_url: "/",
            display: "standalone",
            background_color: "#ffffff",
            theme_color: "#FF073A",
            orientation: "portrait",
            icons: [
                {
                    src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23FF073A'/%3E%3Ctext x='50' y='60' font-family='Arial' font-size='40' font-weight='bold' text-anchor='middle' fill='white'%3ET%3C/text%3E%3C/svg%3E",
                    sizes: "192x192",
                    type: "image/svg+xml"
                },
                {
                    src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23FF073A'/%3E%3Ctext x='50' y='60' font-family='Arial' font-size='40' font-weight='bold' text-anchor='middle' fill='white'%3ET%3C/text%3E%3C/svg%3E",
                    sizes: "512x512",
                    type: "image/svg+xml"
                }
            ],
            categories: ["finance", "utilities"],
            shortcuts: [
                {
                    name: "Connect TronLink",
                    short_name: "Connect",
                    description: "Quickly connect to TronLink wallet",
                    url: "/?action=connect",
                    icons: [{ src: "/icon-192x192.png", sizes: "192x192" }]
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
        const manifestUrl = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').href = manifestUrl;

        // PWA Install Prompt Component
        const InstallPrompt = () => {
            const [showInstall, setShowInstall] = React.useState(false);
            const [deferredPrompt, setDeferredPrompt] = React.useState(null);

            React.useEffect(() => {
                const handleBeforeInstallPrompt = (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e);
                    setShowInstall(true);
                };

                const handleAppInstalled = () => {
                    setShowInstall(false);
                    setDeferredPrompt(null);
                };

                window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
                window.addEventListener('appinstalled', handleAppInstalled);

                return () => {
                    window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
                    window.removeEventListener('appinstalled', handleAppInstalled);
                };
            }, []);

            const handleInstall = async () => {
                if (!deferredPrompt) return;

                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    setShowInstall(false);
                }
                setDeferredPrompt(null);
            };

            if (!showInstall) return null;

            return (
                <div 
                    style={{
                        position: 'fixed',
                        bottom: '20px',
                        right: '20px',
                        background: '#FF073A',
                        color: 'white',
                        padding: '15px 20px',
                        borderRadius: '10px',
                        boxShadow: '0 5px 15px rgba(0,0,0,0.3)',
                        cursor: 'pointer',
                        transition: 'transform 0.3s ease',
                        zIndex: 1000
                    }}
                    onClick={handleInstall}
                    onMouseOver={(e) => e.target.style.transform = 'translateY(-2px)'}
                    onMouseOut={(e) => e.target.style.transform = 'translateY(0px)'}
                >
                    📱 Install App
                </div>
            );
        };

        // Main App with Install Prompt
        const App = () => (
            <>
                <TronWalletPWA />
                <InstallPrompt />
            </>
        );

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
